<%- include("partials/header.ejs") %>

  <% if (locals.data) { %>
    <header>
      <div class="search-div">
        <form action="/today" method="post">
          <input type="text" name="loc" id="location">
          <input type="submit" value="submit" id="loc-submit">
        </form>
      </div>
    </header>

    <%- include("partials/nav.ejs") %>
    
    <main class="hour-main">
      <div class="loc-header hourly-header">
        <h1>
          <%= data.location.name %>, <%= data.location.region %>
        </h1>
      </div>
      <div class="full-box">

        <% for (i = 0; i < forecastday.length; i++) { %>
        
        <div class="days-box">
          <div class="hourly-day-container">
            <%
              let newDate = new Date(forecastday[i].date_epoch * 1000.05);
              const daysOfWeek = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
              const monthsOfYear = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            %>
            <h2 class="hourly-day"><%= daysOfWeek[newDate.getDay()] %>,</h2>
            <h2 class="hourly-date"><%= monthsOfYear[newDate.getMonth()] %> <%= newDate.getDate() %></h2>
          </div>
          <div class="hours-box">
            <% for (j = 0; j < forecastday[i].hour.length; j++) { %>
              <% if (forecastday[i].hour[j].time_epoch > nower) { %>
              <div class="line-box-container">
                <div class="hour-line">
                  <%  
                    const hourDigit = forecastday[i].hour[j].time.split(" ");
                    hourDigit.shift();
                    let newDigit = hourDigit[0].split(":");
                    newDigit.pop();
                    const regex = /[0](?=[1-9])/;
                    newDigit = newDigit[0].replace(regex, "");
                    let period = newDigit >= 12 ? 'pm' : 'am';
                    newDigit = newDigit > 12 ? newDigit - 12 : newDigit;
                    newDigit = newDigit == 0 ? 12 : newDigit; 
                  %>
                  <p><%= newDigit %><%= period %></p>
                  <p><%= Math.round(forecastday[i].hour[j].temp_f) %>&#176;</p>
                  <img src="<%= forecastday[i].hour[j].condition.icon %>" alt="<%= forecastday[i].hour[j].condition.text %> icon" class="hour-icon">
                  <p class="hour-cond"><%= forecastday[i].hour[j].condition.text %></p>
                  <p><%= forecastday[i].hour[j].chance_of_rain %>%</p>
                  <button class="down-btn" value="<%= forecastday[i].hour[j].time_epoch %>">V</button>
                </div>
                <div class="invisibox" id="<%= forecastday[i].hour[j].time_epoch %>">
                  <div>
                    <p><i>Feels like</i></p>
                    <p><%= Math.round(forecastday[i].hour[j].feelslike_f) %></p>
                  </div>
                  <div>
                    <p><i>Humidity</i></p>
                    <p><%= forecastday[i].hour[j].humidity %>%</p>
                  </div>
                  <div>
                    <p><i>Wind</i></p>
                    <p><%= forecastday[i].hour[j].wind_dir %> <%= Math.round(forecastday[i].hour[j].wind_mph) %> mph</p>
                  </div>
                  <div>
                    <p><i>Cloud Cover</i></p>
                    <p><%= forecastday[i].hour[j].cloud %>%</p>
                  </div>
                </div>
              </div>
              <% } %>

            <% } %>
          </div>
        </div>

        <% } %>

      </div>
    </main>
  <% } %>

<%- include("partials/footer.ejs") %>