<%- include("partials/header.ejs") %>

  <% if (locals.data) { %>
    <header>
      <form action="/today" method="post">
        <input type="text" name="loc" id="location">
        <input type="submit" value="submit">
      </form>
    </header>

    <%- include("partials/nav.ejs") %>
    
    <main>
      <div class="loc-header">
        <h1>
          <%= data.location.name %>, <%= data.location.region %>
        </h1>
      </div>
      <div>

        <% for (i = 0; i < forecastday.length; i++) { %>
        
        <div>
          <div>
            <%
              let newDate = new Date(forecastday[i].date_epoch * 1000.05);
              const daysOfWeek = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
              const monthsOfYear = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            %>
            <h2 class="hourly-day"><%= daysOfWeek[newDate.getDay()] %>,</h2>
            <h2 class="hourly-date"><%= monthsOfYear[newDate.getMonth()] %> <%= newDate.getDate() %></h2>
          </div>
          <div>
            <% for (j = 0; j < forecastday[i].hour.length; j++) { %>
              <% if (forecastday[i].hour[j].time_epoch > nower) { %>
              <div>
                <%  
                  const hourDigit = forecastday[i].hour[j].time.split(" ");
                  hourDigit.shift();
                  let newDigit = hourDigit[0].split(":");
                  newDigit.pop();
                  const regex = /[0](?=[1-9])/;
                  newDigit = newDigit[0].replace(regex, "");
                  let period = newDigit >= 12 ? 'pm' : 'am';
                  newDigit = newDigit > 12 ? newDigit - 12 : newDigit;
                  newDigit = newDigit == 0 ? 12 : newDigit; 
                %>
                <p><%= newDigit %> <%= period %></p>
                <p><%= Math.round(forecastday[i].hour[j].temp_f) %>&#176;</p>
                <img src="<%= forecastday[i].hour[j].condition.icon %>" alt="<%= forecastday[i].hour[j].condition.text %> icon">
                <p><%= forecastday[i].hour[j].condition.text %></p>
                <p><%= forecastday[i].hour[j].chance_of_rain %>%</p>
                <button>V</button>
                <div>
                  <div>
                    <p>Feels like</p>
                    <p><%= Math.round(forecastday[i].hour[j].feelslike_f) %></p>
                  </div>
                  <div>
                    <p>Humidity</p>
                    <p><%= forecastday[i].hour[j].humidity %>%</p>
                  </div>
                  <div>
                    <p>Wind</p>
                    <p><%= forecastday[i].hour[j].wind_dir %> <%= Math.round(forecastday[i].hour[j].wind_mph) %> mph</p>
                  </div>
                  <div>
                    <p>Cloud Cover</p>
                    <p><%= forecastday[i].hour[j].cloud %>%</p>
                  </div>
                </div>
              </div>
              <% } %>

            <% } %>
          </div>
        </div>

        <% } %>

      </div>
    </main>
  <% } %>

<%- include("partials/footer.ejs") %>